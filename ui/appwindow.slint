import { Button, VerticalBox , HorizontalBox, LineEdit, ListView, CheckBox, GroupBox, Palette } from "std-widgets.slint";
import { Style } from "style.slint";
import { Notes, NoteItem } from "notes_view.slint";
import { FileDiffView, Diff, DiffFileItem } from "file_diff_view.slint";
import { DiffConfigView, Repository} from "diff_config_view.slint";
import { Popup } from "popup.slint";
import { FileNotesPopup } from "file_notes_popup.slint";
import { StringUtils } from "string_utils.slint";
import { Menu, MenuItem } from "menu.slint";
import { AppConfig, AppConfigPopup } from "app_config_popup.slint";

export { AppConfig, Notes, NoteItem, Diff, DiffFileItem, Repository, StringUtils }

export global Project {
    in property <string> path;
    out property <bool> is_loaded: path != "";
    callback open;
    callback new;
    callback save;
}

export component AppWindow inherits Window {
    callback close;

    width: 1000px;
    height: 1000px;
    title: Project.path;

    notes-popup := FileNotesPopup {
        initial_x: (root.width / 2) - (self.width / 2);
        initial_y: (root.height / 2) - (self.height / 2);
    }
    app-config-popup := AppConfigPopup {
        initial_x: (root.width / 2) - (self.width / 2);
        initial_y: (root.height / 2) - (self.height / 2);
    }

    VerticalLayout {
        menu-rect := Rectangle {
            background: #262525;
            height: 40px;

            HorizontalLayout {
                alignment: start;
                spacing: Style.spacing;

                Menu {
                    text: "File";

                    MenuItem {
                        text: "New";
                        clicked => { Project.new() }
                    }
                    MenuItem {
                        text: "Open";
                        clicked => { Project.open() }
                    }
                    MenuItem {
                        text: "Save";
                        enabled: Project.is_loaded;
                        clicked => { Project.save() }
                    }
                    MenuItem {
                        text: "Close";
                        clicked => { root.close() }
                    }
                }
                Menu {
                    text: "Edit";

                    MenuItem {
                        text: "Config";
                        clicked => { app-config-popup.open() }
                    }
                }
            }
        }
        VerticalBox {
            if Project.is_loaded: DiffConfigView {
                height: 100px;
            }
            if Repository.is_loaded: FileDiffView {
                open-file-notes-popup(file) => { notes-popup.open-notes(file) }
            }
        }
    }
}
